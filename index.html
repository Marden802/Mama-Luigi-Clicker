<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mama Luigi Clicker: Ultimate</title>
    <style>
        body { text-align: center; font-family: 'Arial', sans-serif; background: #e8f5e9; display: flex; flex-direction: column; height: 100vh; margin: 0; overflow: hidden; }
        #header { background: #1b5e20; color: white; padding: 5px; border-bottom: 4px solid #ffd700; }
        
        #news-container { background: #222; color: #0f0; padding: 10px; font-family: monospace; height: 20px; overflow: hidden; white-space: nowrap; border-bottom: 2px solid #1b5e20; }
        #ticker-text { display: inline-block; animation: marquee 40s linear infinite; }
        @keyframes marquee { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        #main-container { display: flex; flex: 1; overflow: hidden; }
        #game-area { flex: 1; padding: 20px; background: #c8e6c9; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border-right: 4px solid #1b5e20; }
        
        #luigi { width: 200px; cursor: pointer; user-select: none; transition: transform 0.05s; }
        #luigi:active { transform: scale(0.95); }

        #meter-container { width: 200px; height: 15px; background: #333; border-radius: 10px; margin: 5px; border: 2px solid #555; overflow: hidden; }
        #meter-fill { width: 0%; height: 100%; background: #ffeb3b; }

        #meatball { position: absolute; width: 70px; height: 70px; cursor: pointer; display: none; z-index: 100; filter: drop-shadow(0 0 10px gold) brightness(1.2); transition: transform 0.1s; }
        #meatball:active { transform: scale(0.8); }

        #sidebar { flex: 1; background: white; display: flex; flex-direction: column; }
        .tab-bar { display: flex; background: #333; }
        .tab-btn { flex: 1; padding: 15px; border: none; cursor: pointer; color: white; font-weight: bold; background: #333; }
        .tab-btn.active { background: #4caf50; }
        #tab-content { flex: 1; overflow-y: scroll; padding: 15px; }

        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 5px; border: 1px solid #ddd; background: #f9f9f9; border-radius: 5px; }
        .upgrade-btn { padding: 10px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; min-width: 80px; }
        .upgrade-btn:disabled { background: #ccc !important; cursor: not-allowed; }
        
        .stats { font-size: 24px; font-weight: bold; color: #1b5e20; }
        .sys-btn { margin: 5px; padding: 8px; cursor: pointer; font-weight: bold; border-radius: 5px; }

        /* Notification Styling */
        #save-popup { position: fixed; bottom: 20px; left: 20px; background: #333; color: white; padding: 10px; border-radius: 5px; display: none; z-index: 1000; font-size: 12px; }
    </style>
</head>
<body>

    <div id="save-popup">üíæ Game Auto-Saved!</div>
    <div id="header"><h2 style="margin:0;">Mama Luigi Clicker: Ultimate</h2></div>
    <div id="news-container"><div id="ticker-text">Welcome! Click Luigi to begin...</div></div>

    <div id="main-container">
        <div id="game-area">
            <img id="meatball" src="meatball.png" onclick="clickMeatball()" alt="GOLDEN MEATBALL">
            <div class="stats">Luigis: <span id="count">0</span></div>
            <div style="font-weight:bold;">LPS: <span id="lps-text">0</span> | Caps: <span id="caps-text">0</span></div>
            <div style="font-size:12px; margin-top:10px;">Spaghetti Buff: +<span id="stat-buff">0</span>%</div>
            <div id="meter-container"><div id="meter-fill"></div></div>
            
            <img id="luigi" src="Mama Luigi.png" onclick="clickLuigi()">
            
            <div style="margin-top:20px;">
                <button class="sys-btn" style="background:#ffd700;" onclick="prestige()">PRESTIGE (+<span id="pending-caps">0</span>)</button>
                <button class="sys-btn" id="m-btn" onclick="toggleMusic()">üéµ Play Music</button>
                <button class="sys-btn" onclick="saveGame(true)">üíæ Save</button>
                <button class="sys-btn" style="background:#ff5252; color:white;" onclick="resetGame()">üßπ Reset</button>
            </div>

            <audio id="clickSound" src="mama-luigi_1.mp3"></audio>
            <audio id="screamSound" src="mama-luigi-scream.mp3"></audio>
            <audio id="bgMusic" src="04. Face Collection.mp3" loop></audio>
        </div>

        <div id="sidebar">
            <div class="tab-bar">
                <button id="btn-up" class="tab-btn active" onclick="switchTab('upgrades')">ITEMS</button>
                <button id="btn-mkt" class="tab-btn" onclick="switchTab('market')">MARKET</button>
                <button id="btn-tro" class="tab-btn" onclick="switchTab('trophies')">TROPHIES</button>
            </div>
            <div id="tab-content"></div>
        </div>
    </div>

    <script>
        let score = 0, allTime = 0, caps = 0, multi = 1, buff = 0, meter = 0;
        let currentTab = 'upgrades', musicOn = false, frenzy = false;
        let currentHeadline = "Welcome! Click Luigi to begin your pasta empire...";
        let headlineTimer = 0;

        const upgrades = [];
        for(let i=0; i<100; i++) {
            upgrades.push({ id: i, name: "Gear #"+(i+1), baseCost: 15 * Math.pow(1.28, i), power: 1.5 * Math.pow(1.32, i), count: 0 });
        }
        const market = [];
        for(let i=0; i<20; i++) {
            market.push({ id: i, name: "Mult x2 #"+(i+1), cost: Math.pow(5, i+1), bought: false });
        }
        const headlines = ["Local man finds green hat.", "Pasta water found in reservoir.", "Luigi forgets how to jump.", "Is it pasta? Or destiny?", "Green socks up 2%.", "Luigi carrying 100 meatballs.", "Goomba spotted at park.", "Mansion bill is too high.", "Mama Luigi is his legal name.", "Pasta shortages reported.", "Yoshi eats park benches.", "Castle deeds traded for pasta.", "Koopa hates green.", "Magic beans found.", "Goombas want better hats.", "Mustache seen from space.", "Ghost population drops.", "Is Luigi made of pasta?", "Dinosaur Land renamed.", "Fire flowers used as heaters.", "Meatball Standard Economy.", "Bowser retires to open a modest pizzeria.", "Green caps mandatory.", "Luigi jumps over moon.", "The Luigipocalypse has begun.", "Gravity fails.", "Intergalactic spaghetti storm.", "Luigi is world heat source.", "Universe is inside a green sock.", "Stop clicking!", "Magic carpet licenses required.", "Dino eggs hatch chickens.", "New bird species found.", "Vacuum bag full of lint.", "Meatball rain predicted.", "Pipe system is a circle.", "Green sock stock surge.", "Luigi needs a snack.", "Bowser invites Luigi to dinner.", "Spiny shells banned.", "Lakitu starts delivery.", "Toad is in another restaurant.", "Mama Luigi flying.", "Stolen hats returned.", "Ghost maps upside down.", "Castle deeds for pasta.", "Plumber trips, saves day.", "Green is the new red.", "100% Organic Kingdom.", "Brick blocks are cake.", "Frog suits in Paris.", "Star man blindness.", "Luigi finds twin.", "Spaghetti trees found.", "Pasta Day every day.", "Chocolate coins found.", "Hammer Bros union.", "Bullet Bill mailman.", "Wario buys Luigi badges.", "Koopa shell helmets.", "Lake is Minestrone.", "Pasta Museum opens.", "Security piranha plants.", "Marshmallow clouds.", "Yoshi fruit snacks.", "Tomato sauce lava.", "Bright green shirt.", "Secret kitchen pipe.", "Meatball panic.", "Premium sauce oil.", "Pasta for Peace.", "Jump earthquake.", "Sentient mushrooms.", "Hug a Boo.", "Thwomp percussion.", "Dry Bones moisturizer.", "Swimming Cheep Cheeps.", "Mole digs to China.", "Ink art movement.", "Chomp door knockers.", "Wiggler anger management.", "Pokey coat rack.", "Baguette magic wand.", "Circus Lemmy.", "Symphony of Meatball.", "Morton wins eating contest.", "Hair gel Iggy.", "Luxury rings Wendy.", "Power pink Roy.", "DJ Larry.", "Spicy science magic.", "Heating Reznor.", "Football Chuck.", "Broccoli vacuum.", "Mama Luigi transcends.", "Atom Luigis.", "Final pasta cooked.", "Infinity Luigi.", "You are Mama Luigi."];

        function clickLuigi() {
            let gain = (1 * multi) * (1 + buff / 100);
            if(frenzy) gain *= 77;
            score += gain; allTime += gain;
            meter += 4;
            if(meter >= 100) { meter = 0; buff += 1; }
            playSound('clickSound');
            updateUI();
        }

        function buyUpgrade(id) {
            let up = upgrades[id];
            let cost = Math.floor(up.baseCost * Math.pow(1.15, up.count));
            if(score >= cost) {
                score -= cost; up.count++;
                playSound('screamSound');
                renderTab(); updateUI();
            }
        }

        function buyMarket(id) {
            let m = market[id];
            if(caps >= m.cost && !m.bought) {
                caps -= m.cost; m.bought = true; multi *= 2;
                renderTab(); updateUI();
            }
        }

        function prestige() {
            let p = Math.floor(Math.sqrt(allTime / 1000000)) - caps;
            if(p <= 0) return alert("Need 1,000,000 Total Luigis!");
            caps += p; score = 0;
            upgrades.forEach(u => u.count = 0);
            renderTab(); updateUI();
        }

        function playSound(id) { let s = document.getElementById(id); s.currentTime=0; s.play().catch(()=>{}); }

        function toggleMusic() {
            let m = document.getElementById('bgMusic');
            let b = document.getElementById('m-btn');
            musicOn ? m.pause() : m.play().catch(()=>alert("Click Luigi first!"));
            musicOn = !musicOn;
            b.innerText = musicOn ? "‚è∏ Pause Music" : "üéµ Play Music";
        }

        function switchTab(t) {
            currentTab = t;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + (t=='upgrades'?'up':t=='market'?'mkt':'tro')).classList.add('active');
            renderTab();
        }

        function renderTab() {
            let cont = document.getElementById('tab-content');
            cont.innerHTML = "";
            if(currentTab === 'upgrades') {
                upgrades.forEach(u => {
                    let cost = Math.floor(u.baseCost * Math.pow(1.15, u.count));
                    cont.innerHTML += `<div class="item-row"><div><strong>${u.name}</strong> (${u.count})</div><button class="upgrade-btn" id="up-btn-${u.id}" onclick="buyUpgrade(${u.id})">${cost.toLocaleString()}</button></div>`;
                });
            } else if(currentTab === 'market') {
                market.forEach(m => {
                    cont.innerHTML += `<div class="item-row"><div><strong>${m.name}</strong></div><button class="upgrade-btn" style="background:#ffd700;color:black;" id="mkt-btn-${m.id}" onclick="buyMarket(${m.id})">${m.bought?'OWNED' : m.cost+' Caps'}</button></div>`;
                });
            } else {
                for(let i=0; i<20; i++) {
                    let goal = Math.pow(10, i+2);
                    let ok = allTime >= goal;
                    cont.innerHTML += `<div class="item-row" style="opacity:${ok?1:0.3}"><div>Trophy #${i+1}</div><div>${ok?'üèÜ':'üîí'}</div></div>`;
                }
            }
        }

        function updateUI() {
            document.getElementById('count').innerText = Math.floor(score).toLocaleString();
            document.getElementById('caps-text').innerText = caps.toLocaleString();
            document.getElementById('stat-buff').innerText = buff;
            document.getElementById('meter-fill').style.width = meter + "%";
            let lps = upgrades.reduce((s, u) => s + (u.power * u.count), 0) * multi * (1 + buff/100);
            document.getElementById('lps-text').innerText = Math.floor(lps).toLocaleString();
            let p = Math.floor(Math.sqrt(allTime / 1000000)) - caps;
            document.getElementById('pending-caps').innerText = Math.max(0, p);

            if(currentTab === 'upgrades') {
                upgrades.forEach(u => {
                    let cost = Math.floor(u.baseCost * Math.pow(1.15, u.count));
                    let btn = document.getElementById('up-btn-' + u.id);
                    if(btn) btn.disabled = (score < cost);
                });
            } else if(currentTab === 'market') {
                market.forEach(m => {
                    let btn = document.getElementById('mkt-btn-' + m.id);
                    if(btn) btn.disabled = (caps < m.cost || m.bought);
                });
            }

            headlineTimer++;
            if (headlineTimer >= 100) { 
                const idx = Math.min(Math.floor(allTime / 1000), headlines.length - 1);
                currentHeadline = headlines[idx];
                headlineTimer = 0;
            }
            const tick = document.getElementById('ticker-text');
            if(tick.innerText !== currentHeadline) tick.innerText = currentHeadline;
        }

        function clickMeatball() {
            document.getElementById('meatball').style.display = 'none';
            frenzy = true; document.getElementById('game-area').style.background = "#fff176";
            setTimeout(() => { frenzy = false; document.getElementById('game-area').style.background = "#c8e6c9"; }, 15000);
        }

        // --- LOOPS & AUTO-SAVE ---
        setInterval(() => {
            let lps = (upgrades.reduce((s, u) => s + (u.power * u.count), 0) * multi * (1 + buff/100)) / 10;
            score += lps; allTime += lps;
            updateUI();
        }, 100);

        setInterval(() => {
            let m = document.getElementById('meatball');
            m.style.left = (Math.random()*80)+"%"; m.style.top = (Math.random()*80)+"%";
            m.style.display = 'block'; setTimeout(() => m.style.display='none', 6000);
        }, 45000);

        // Auto-save every 15 seconds
        setInterval(() => { saveGame(false); }, 15000);

        function saveGame(manual) {
            const d = { score, allTime, caps, multi, buff, upCounts: upgrades.map(u=>u.count), mktBought: market.map(m=>m.bought) };
            localStorage.setItem("ML_SAVE", JSON.stringify(d));
            
            // Show popup
            const pop = document.getElementById('save-popup');
            pop.style.display = 'block';
            setTimeout(() => { pop.style.display = 'none'; }, 2000);
            if(manual) alert("Game Saved Manually!");
        }

        function loadGame() {
            const d = JSON.parse(localStorage.getItem("ML_SAVE"));
            if(d) {
                score = d.score; allTime = d.allTime; caps = d.caps; multi = d.multi; buff = d.buff || 0;
                if(d.upCounts) d.upCounts.forEach((c, i) => { if(upgrades[i]) upgrades[i].count = c; });
                if(d.mktBought) d.mktBought.forEach((b, i) => { if(market[i]) market[i].bought = b; });
            }
            renderTab(); updateUI();
        }

        function resetGame() { if(confirm("Are you sure? You will lose all your pasta!")) { localStorage.clear(); location.reload(); } }
        
        window.onload = loadGame;
    </script>
</body>
</html>
